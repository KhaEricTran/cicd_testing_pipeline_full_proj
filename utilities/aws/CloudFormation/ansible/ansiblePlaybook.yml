- hosts: dockerserver
  tasks:
    - name: Start the docker service
      command: sudo service docker start
      ignore_errors: yes

    - name: Register all docker containers id are running
      command: sudo docker ps -aq
      register: dockerContainerIds

    - name: Register all current docker images id
      command: sudo docker images -aq
      register: dockerImagesIds

    - name: Stop all containers
      command: "sudo docker stop my-rmit-store"
      ignore_errors: yes

    - name: Remove all containers
      command: "sudo docker rm my-rmit-store"
      ignore_errors: yes

    - name: Remove all images
      command: "sudo docker rmi --force advanced-task:latest"
      ignore_errors: yes

    - name: Log out if connected to Docker
      command: sudo docker logout
      ignore_errors: yes

    - name: Log in to the Dockerhub Account
      command: sudo docker login -u "3750945" -p "040421Ed!." docker.io

    - name: Build images based on the Dockerfile on Docker server
      command: sudo docker build -t advanced-task:latest .

    - name: Run the apache container based on pushed docker hub image
      command: sudo docker run -d --name my-rmit-store --rm -p 8080:80 advanced-task:latest